name: Guide Notebooks Regression
run-name: Guide Notebooks Regression
on: [push]
jobs:
  guide-notebooks-regression:
    runs-on: self-hosted
    steps:
      - run: echo "automatically triggered by a ${{ github.event_name }} event"
      - run: echo "running on a ${{ runner.os }} server hosted by github"
      - name: clone
        uses: actions/checkout@v3
      - name: install
        run: |
          cd ${{ github.workspace }}
          python -m venv env
          source env/bin/activate
          pip install --upgrade pip
          pip install jupyter
          pip install -e .
          nobrainer info
      - name: run
        run: |
          for notebook in $(ls guide/[0-9][0-9]-*.ipynb); do
            srun \
              -p gablab \
              --mem=16G \
              -t 10 \
              singularity exec \
                --nv -B /om \
                ${HOME}/img/tensorflow_latest-gpu.sif \
                  ./run.sh \
                    jupyter nbconvert \
                      --execute ${notebook} \
                      --to markdown \
                      --stdout
          done

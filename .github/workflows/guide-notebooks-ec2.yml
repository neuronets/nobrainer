name: Guide Notebooks Regression - EC2
run-name: Guide Notebooks Regression - EC2
on: [push]
jobs:
  guide_notebooks_regression_ec2:
    runs-on: [self-hosted, nobrainer-ci-ec2]
    steps:
      - name: clone
        uses: actions/checkout@v3
      - name: install
        run: |
          set -xe
          cd ${{ github.workspace }}
          python3 -m venv env
          source env/bin/activate
          pip install --upgrade pip
          pip install jupyter
          pip install -e .
          nobrainer info
      - name: run
        run: |
          set -xe
          cd ${{ github.workspace }}
          source env/bin/activate
          echo $(which python)
          for notebook in $(ls guide/[0-9][0-9]-*.ipynb); do
            echo "running ${notebook}"
            jupyter nbconvert \
              --execute ${notebook} \
              --to markdown \
              --stdout
          done
